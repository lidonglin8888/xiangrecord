import router from '@ohos.router';
import { TopNavigation } from '../components/TopNavigation';

@Entry
@Component
struct UpdateLogPage {
  @State updateLogs: UpdateLog[] = [
    {
      version: 'v1.2.0',
      date: '2024-06-17',
      type: 'major',
      features: [
        'ğŸ‰ å…¨æ–°åº•éƒ¨Tabæ è®¾è®¡ï¼Œæ“ä½œæ›´ä¾¿æ·',
        'ğŸ‘¤ æ–°å¢"æˆ‘çš„"é¡µé¢ï¼Œä¸ªäººä¿¡æ¯ç®¡ç†æ›´å®Œå–„',
        'ğŸ” å®Œå–„ç”¨æˆ·ç™»å½•æ³¨å†Œæµç¨‹',
        'ğŸ“± ä¼˜åŒ–ç•Œé¢å¸ƒå±€ï¼Œæå‡ç”¨æˆ·ä½“éªŒ'
      ],
      fixes: [
        'ğŸ› ä¿®å¤æ•°æ®åŒæ­¥å¶å°”å¤±è´¥çš„é—®é¢˜',
        'ğŸ› ä¿®å¤è®°å½•è¯¦æƒ…é¡µé¢æ˜¾ç¤ºå¼‚å¸¸',
        'ğŸ› ä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼Œæå‡åº”ç”¨ç¨³å®šæ€§'
      ]
    },
    {
      version: 'v1.1.5',
      date: '2024-06-10',
      type: 'minor',
      features: [
        'ğŸ“Š æ–°å¢æ•°æ®ç»Ÿè®¡å›¾è¡¨',
        'ğŸ”„ ä¼˜åŒ–äº‘ç«¯åŒæ­¥æœºåˆ¶',
        'ğŸ¨ ç•Œé¢ç»†èŠ‚ä¼˜åŒ–'
      ],
      fixes: [
        'ğŸ› ä¿®å¤ç™»å½•çŠ¶æ€å¼‚å¸¸é—®é¢˜',
        'ğŸ› ä¿®å¤éƒ¨åˆ†æœºå‹é€‚é…é—®é¢˜'
      ]
    },
    {
      version: 'v1.1.0',
      date: '2024-06-01',
      type: 'major',
      features: [
        'â˜ï¸ æ–°å¢äº‘ç«¯æ•°æ®åŒæ­¥åŠŸèƒ½',
        'ğŸ”‘ æ”¯æŒåä¸ºè´¦å·ã€å¾®ä¿¡ã€æ‰‹æœºå·ç™»å½•',
        'ğŸ“± æ–°å¢æœ¬åœ°æ¨¡å¼å’Œäº‘ç«¯æ¨¡å¼åˆ‡æ¢',
        'ğŸ”’ å¢å¼ºæ•°æ®å®‰å…¨ä¿æŠ¤'
      ],
      fixes: [
        'ğŸ› ä¿®å¤è®°å½•æ—¶é—´æ˜¾ç¤ºé—®é¢˜',
        'ğŸ› ä¼˜åŒ–åº”ç”¨å¯åŠ¨é€Ÿåº¦'
      ]
    },
    {
      version: 'v1.0.5',
      date: '2024-05-20',
      type: 'patch',
      features: [
        'ğŸ“ ä¼˜åŒ–è®°å½•æ·»åŠ æµç¨‹',
        'ğŸ¯ æ”¹è¿›ç”¨æˆ·å¼•å¯¼ä½“éªŒ'
      ],
      fixes: [
        'ğŸ› ä¿®å¤å†å²è®°å½•æ’åºé—®é¢˜',
        'ğŸ› ä¿®å¤éƒ¨åˆ†æ–‡å­—æ˜¾ç¤ºå¼‚å¸¸',
        'ğŸ› æå‡åº”ç”¨ç¨³å®šæ€§'
      ]
    },
    {
      version: 'v1.0.0',
      date: '2024-05-01',
      type: 'major',
      features: [
        'ğŸ‰ ä¾¿ä¾¿è®°å½•å°åŠ©æ‰‹æ­£å¼å‘å¸ƒï¼',
        'ğŸ“ æ”¯æŒä¾¿ä¾¿è®°å½•æ·»åŠ å’Œç¼–è¾‘',
        'ğŸ“Š æä¾›å†å²è®°å½•æŸ¥çœ‹',
        'ğŸ’¾ æœ¬åœ°æ•°æ®å­˜å‚¨',
        'ğŸ¨ ç²¾ç¾çš„ç•Œé¢è®¾è®¡'
      ],
      fixes: []
    }
  ];

  build() {
    Column() {
      // é¡¶éƒ¨å¯¼èˆª
      TopNavigation({
        title: 'æ›´æ–°æ—¥å¿—',
        showBackButton: true
      })
      
      // æ›´æ–°æ—¥å¿—å†…å®¹
      Scroll() {
        Column() {
          this.UpdateLogContent()
        }
        .width('100%')
        .padding({ left: 16, right: 16, top: 20, bottom: 20 })
      }
      .layoutWeight(1)
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#FFF8E7')
  }

  @Builder
  UpdateLogContent() {
    Column() {
      Text('ç‰ˆæœ¬æ›´æ–°å†å²')
        .fontSize(20)
        .fontWeight(FontWeight.Bold)
        .fontColor('#8B4513')
        .margin({ bottom: 20 })
      
      ForEach(this.updateLogs, (log: UpdateLog, index: number) => {
        this.UpdateLogItem(log, index === 0)
      })
    }
    .width('100%')
  }

  @Builder
  UpdateLogItem(log: UpdateLog, isLatest: boolean) {
    Column() {
      // ç‰ˆæœ¬å¤´éƒ¨
      Row() {
        Column() {
          Row() {
            Text(log.version)
              .fontSize(18)
              .fontWeight(FontWeight.Bold)
              .fontColor('#8B4513')
            
            if (isLatest) {
              Text('æœ€æ–°')
                .fontSize(12)
                .fontColor('#FFFFFF')
                .backgroundColor('#FF9500')
                .borderRadius(10)
                .padding({ left: 8, right: 8, top: 2, bottom: 2 })
                .margin({ left: 8 })
            }
            
            Text(this.getVersionTypeText(log.type))
              .fontSize(12)
              .fontColor('#FFFFFF')
              .backgroundColor(this.getVersionTypeColor(log.type))
              .borderRadius(10)
              .padding({ left: 8, right: 8, top: 2, bottom: 2 })
              .margin({ left: 8 })
          }
          
          Text(log.date)
            .fontSize(14)
            .fontColor('#999999')
            .margin({ top: 4 })
        }
        .alignItems(HorizontalAlign.Start)
        
        Blank()
      }
      .width('100%')
      .margin({ bottom: 16 })
      
      // æ–°åŠŸèƒ½
      if (log.features.length > 0) {
        Column() {
          Text('âœ¨ æ–°åŠŸèƒ½')
            .fontSize(16)
            .fontWeight(FontWeight.Medium)
            .fontColor('#34C759')
            .alignSelf(ItemAlign.Start)
            .margin({ bottom: 8 })
          
          ForEach(log.features, (feature: string) => {
            Text(feature)
              .fontSize(14)
              .fontColor('#333333')
              .margin({ bottom: 4, left: 16 })
              .alignSelf(ItemAlign.Start)
          })
        }
        .width('100%')
        .alignItems(HorizontalAlign.Start)
        .margin({ bottom: 16 })
      }
      
      // é—®é¢˜ä¿®å¤
      if (log.fixes.length > 0) {
        Column() {
          Text('ğŸ”§ é—®é¢˜ä¿®å¤')
            .fontSize(16)
            .fontWeight(FontWeight.Medium)
            .fontColor('#FF9500')
            .alignSelf(ItemAlign.Start)
            .margin({ bottom: 8 })
          
          ForEach(log.fixes, (fix: string) => {
            Text(fix)
              .fontSize(14)
              .fontColor('#333333')
              .margin({ bottom: 4, left: 16 })
              .alignSelf(ItemAlign.Start)
          })
        }
        .width('100%')
        .alignItems(HorizontalAlign.Start)
      }
    }
    .width('100%')
    .backgroundColor('#FFFFFF')
    .borderRadius(12)
    .padding(20)
    .margin({ bottom: 16 })
  }

  getVersionTypeText(type: string): string {
    switch (type) {
      case 'major':
        return 'é‡å¤§æ›´æ–°';
      case 'minor':
        return 'åŠŸèƒ½æ›´æ–°';
      case 'patch':
        return 'ä¿®å¤æ›´æ–°';
      default:
        return 'æ›´æ–°';
    }
  }

  getVersionTypeColor(type: string): string {
    switch (type) {
      case 'major':
        return '#FF3B30';
      case 'minor':
        return '#007AFF';
      case 'patch':
        return '#34C759';
      default:
        return '#8E8E93';
    }
  }
}

// æ›´æ–°æ—¥å¿—æ¥å£
interface UpdateLog {
  version: string;
  date: string;
  type: 'major' | 'minor' | 'patch';
  features: string[];
  fixes: string[];
}